<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大学杯 配信サポート (運営ページ)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <style>
        :root {
            --primary-color: #202124;
            --surface-container-color: #F1F3F4;
            --surface-color: #FFFFFF;
            --on-surface-color: #202124;
            --on-surface-variant-color: #5F6368;
            --outline-color: #BDC1C6;
            --primary-container-color: #E8EAED;
            --on-primary-container-color: #202124;
            --font-family: 'Noto Sans JP', sans-serif;
            --border-radius-large: 12px;
            --border-radius-medium: 8px;
            --greyed-out-color: #9AA0A6;
            --xp-highlight-color: #E53935;
            --xp-highlight-bg: #FFEBEE;
        }
        body {
            margin: 0;
            padding: 16px;
            font-family: var(--font-family);
            font-size: 16px;
            color: var(--on-surface-color);
            background-color: var(--surface-container-color);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background-color: var(--surface-color);
            border-radius: var(--border-radius-large);
        }
        .header h1 {
            margin: 0;
            font-size: 22px;
            font-weight: 500;
        }
        .connection-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            font-size: 14px;
            font-weight: 500;
            color: var(--on-primary-container-color);
            background-color: var(--primary-container-color);
            border-radius: var(--border-radius-medium);
        }
        .connection-indicator .status-dot {
            width: 10px;
            height: 10px;
            background-color: #34A853;
            border-radius: 50%;
        }
        
        /* --- コメントエリア --- */
        .comment-area {
            margin-top: 16px;
            margin-bottom: 16px;
            padding: 16px;
            background-color: var(--surface-color);
            border-radius: var(--border-radius-large);
        }
        .comment-area h2, .script-card h2 {
            margin: 0 0 10px 0;
            font-size: 15px;
            font-weight: 700;
        }
        .comment-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        .comment-input-group input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--outline-color);
            font-size: 15px;
            border-radius: var(--border-radius-medium);
        }
        .comment-input-group button {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 0 16px;
            border: none;
            color: white;
            background-color: var(--primary-color);
            border-radius: var(--border-radius-medium);
            cursor: pointer;
        }
        .comment-history .comment-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            font-size: 14px;
        }
        .comment-history .comment-item:first-child {
            padding-top: 0;
        }
        .comment-history .badge {
            flex-shrink: 0;
            width: 50px;
            padding: 2px 0;
            font-size: 10px;
            font-weight: 700;
            text-align: center;
            border-radius: 4px;
        }
        .comment-history .badge.is-self {
            color: var(--on-primary-container-color);
            background-color: var(--primary-container-color);
        }
        .comment-history .badge.is-other {
            color: white;
            background-color: var(--on-surface-variant-color);
        }

        /* --- 台本カード --- */
        .script-card {
            padding: 16px;
            background-color: var(--surface-color);
            border-radius: var(--border-radius-large);
        }
        .script-card .script-paragraph {
            margin: 0 0 8px 0;
            padding: 4px;
            font-size: 15px;
        }
        .script-card .script-paragraph.is-done {
            color: var(--greyed-out-color);
        }
        .script-card .script-paragraph b {
            font-weight: 700;
        }
        .script-card .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
        }
        .script-card .card-footer .outline-button {
            /* 「全体表示」を目立つボタンに変更 */
            width: fit-content;
            padding: 6px 12px;
            border: 1px solid var(--outline-color);
            font-size: 12px;
            font-weight: 500;
            color: var(--on-surface-variant-color);
            background: none;
            border-radius: var(--border-radius-medium);
            cursor: pointer;
        }
        .script-card .card-footer .outline-button:hover {
            background-color: var(--primary-container-color);
        }
        .script-card .card-footer button {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            border: none;
            background-color: var(--primary-container-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .control-panel {
            margin-top: 16px;
            padding: 16px;
            background-color: var(--surface-color);
            border-radius: var(--border-radius-large);
        }
        .control-panel h2 {
            margin: 0 0 10px 0;
            font-size: 15px;
            font-weight: 700;
        }
        .control-group {
            margin-bottom: 16px;
        }
        .control-group:last-child {
            margin-bottom: 0;
        }
        .team-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .team-selector select {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--outline-color);
            font-size: 15px;
            border-radius: var(--border-radius-medium);
        }
        .team-selector .vs-text {
            font-size: 14px;
            font-weight: 700;
        }
        .team-selector button {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
            border: none;
            background-color: var(--primary-container-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .team-display-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px;
        }
        .team-card {
            padding: 24px;
            background-color: var(--surface-color);
            border-radius: var(--border-radius-large);
        }
        .team-card .university-name {
            font-size: 18px;
            font-weight: 700;
        }
        .team-card .team-name {
            margin: 2px 0 0 0;
            font-size: 26px;
            font-weight: 700;
            color: var(--primary-color);
        }
        .team-card .sub-info {
            margin: 4px 0 16px 0;
            font-size: 14px;
            color: var(--on-surface-variant-color);
        }
        .team-card h3 {
            margin-top: 24px;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--primary-container-color);
            font-size: 16px;
            font-weight: 700;
        }
        .team-card p {
            margin: 12px 0;
            line-height: 1.7;
            white-space: pre-wrap;
        }
        .player-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        .player-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--surface-container-color);
        }
        .player-item:last-child {
            border-bottom: none;
        }
        .player-main-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: 500;
        }
        .player-main-info .xp-badge {
            padding: 3px 8px;
            font-size: 12px;
            font-weight: 700;
            color: var(--on-primary-container-color);
            background-color: var(--primary-container-color);
            border-radius: 12px;
        }
        .player-main-info .xp-badge.is-highlight {
            color: var(--xp-highlight-color);
            background-color: var(--xp-highlight-bg);
        }
        .player-weapons {
            margin-top: 6px;
            font-size: 15px;
            color: var(--on-surface-variant-color);
        }

        /* --- モーダル --- */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
        }
        .modal.is-active {
            display: flex;
        }
        .modal-content {
            position: relative;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            padding: 24px;
            background: var(--surface-color);
            border-radius: var(--border-radius-large);
            overflow-y: auto;
        }
        .modal-close {
            position: sticky;
            top: -24px;
            z-index: 10;
            float: right;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 36px;
            height: 36px;
            margin-right: -12px;
            border: none;
            background: var(--surface-container-color);
            border-radius: 50%;
            cursor: pointer;
        }
        .modal-script-list .script-paragraph {
            padding: 12px 8px;
            border-radius: var(--border-radius-medium);
        }
        .modal-script-list .script-paragraph.is-done {
            color: var(--greyed-out-color);
        }
        .modal-script-list .script-paragraph.is-current {
            background-color: var(--primary-container-color);
            cursor: pointer;
        }
    </style>
</head>
<body>

    <header class="header">
        <h1>大学杯 配信サポート (運営ページ)</h1>
        <div class="connection-indicator">
            <div class="status-dot"></div>
            <span>接続状況: <span id="connection-status">正常</span></span>
        </div>
    </header>

    <main>
        <section class="comment-area">
            <h2>コメント送信</h2>
            <div class="comment-input-group">
                <input type="text" id="comment-input" placeholder="実況解説への指示などを入力">
                <button id="send-comment-button"><span class="material-icons-outlined">send</span>送信</button>
            </div>
            <div class="comment-history" id="comment-history"></div>
        </section>

        <section class="script-card">
            <h2>台本</h2>
            <div id="script-card-content"></div>
            <div class="card-footer">
                <button class="outline-button" id="open-script-modal-button">全体表示</button>
                <button id="next-script-button" title="次の段落へ"><span class="material-icons-outlined">skip_next</span></button>
            </div>
        </section>
        
        <section class="control-panel">
            <div class="control-group">
                <h2>▼ 対戦チーム設定 (全体反映)</h2>
                <div class="team-selector">
                    <select id="matchup-alpha-select"></select>
                    <span class="vs-text">VS</span>
                    <select id="matchup-bravo-select"></select>
                </div>
            </div>
            <div class="control-group">
                <h2>▼ 表示チーム切り替え (ローカル)</h2>
                <div class="team-selector">
                    <select id="view-alpha-select"></select>
                    <span class="vs-text">VS</span>
                    <select id="view-bravo-select"></select>
                    <button id="sync-view-button" title="対戦チームの表示に切り替え"><span class="material-icons-outlined">sync_alt</span></button>
                </div>
            </div>
        </section>

        <div class="team-display-area">
            <div id="team-alpha-card" class="team-card"></div>
            <div id="team-bravo-card" class="team-card"></div>
        </div>
    </main>

    <div id="script-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="script-modal-close"><span class="material-icons-outlined">close</span></button>
            <h2>台本全体</h2>
            <div class="modal-script-list" id="modal-script-list"></div>
        </div>
    </div>
    
    <script>
        // --- データ定義 ---
        const teamsData = [
            { id: 'team_a', university: 'イカ大学', teamName: 'インクリングス', players: [
                { name: 'プレイヤーA', xp: 3250, weapons: ['スプラシューター', 'N-ZAP85', 'シャープマーカー'] },
                { name: 'プレイヤーB', xp: 2750, weapons: ['プライムシューター'] },
                { name: 'プレイヤーC', xp: 2600, weapons: ['リッター4K', 'スプラスコープ'] },
                { name: 'プレイヤーD', xp: 2650, weapons: ['スクリュースロッシャー'] }],
                comment: '優勝目指して頑張ります！チーム一丸となって、最高のプレイを見せたいです。応援よろしくお願いします！',
                teamInfo: '各メンバーの連携力を武器に、安定して前線を押し上げるのが得意なチームです。昨年度の大学対抗戦ではベスト4に入賞しており、今大会でも優勝候補の一角と目されています。',
                playerInfo: 'プレイヤーAはXP3200を超えるチームのエースです。特に近距離での対面性能が非常に高く、相手を圧倒します。\nプレイヤーCは長射程ブキでの正確なエイムが光り、後方からチームを支える重要な役割を担っています。',
                circleName: 'インク研究会',
                circleInfo: '週3回、オンラインとオフラインを組み合わせて活動しています。初心者から上級者まで幅広く在籍しており、学内では最大規模のスプラトゥーンサークルです。'
            },
            { id: 'team_b', university: 'オクト大学', teamName: 'オクトエキスパンションズ', players: [
                { name: 'プレイヤーE', xp: 2900, weapons: ['デュアルスイーパーカスタム'] },
                { name: 'プレイヤーF', xp: 3300, weapons: ['スプラチャージャー', 'ジェットスイーパー'] },
                { name: 'プレイヤーG', xp: 2720, weapons: ['ジムワイパー'] },
                { name: 'プレイヤーH', xp: 2680, weapons: ['LACT-450', 'プロモデラーRG'] }],
                comment: '一戦一戦、楽しんで勝ちにいきます。私たちのユニークな戦術に注目してください。',
                teamInfo: 'メンバー個々の対面能力が非常に高く、どんな状況からでも逆転を狙える攻撃的なチーム編成です。特にガチエリアでの打開力には定評があり、その爆発力は大会屈指です。',
                playerInfo: 'プレイヤーFはXP3300を誇る、チームの司令塔的存在です。広い視野と的確な判断力でチームを勝利に導きます。\nプレイヤーHは塗り性能の高いブキを得意とし、盤面をコントロールする能力に長けています。',
                circleName: 'タコゲーミング',
                circleInfo: 'プロ選手を複数輩出したこともある、全国でも有名な強豪サークルです。厳しい練習環境で知られています。'
            },
        ];
        const scriptData = [
            { speaker: '実況', line: 'さあ、始まりました大学杯決勝トーナメント！全国の強豪を勝ち抜いてきた2チームによる、頂上決戦です！' },
            { speaker: '解説', line: '今日の注目はやはり、イカ大学のエース、プレイヤーA選手ですね。彼のパフォーマンスが試合の鍵を握るでしょう。' },
            { speaker: '実況', line: 'XP3200超え、まさに今大会のスタープレイヤーです！対するオクト大学も、チーム全体の練度が非常に高く、一筋縄ではいきません。' },
            { speaker: '解説', line: '特にプレイヤーF選手は、長射程ブキを使いこなし、相手チームに大きなプレッシャーを与え続けることができますからね。' },
            { speaker: '実況', line: '両チーム一歩も譲らない展開！これは序盤から目が離せない、面白い試合になりそうだ！' },
            { speaker: '解説', line: 'そうですね、選手たちの細かな動きや連携にも注目していきたいです。' },
        ];
        
        // --- 状態管理 ---
        let scriptState = { currentIndex: 0 };
        let commentHistory = [
            { sender: 'other', text: 'そろそろ次の試合の告知をお願いします。' },
            { sender: 'self', text: '了解です。準備します。' }
        ];

        // --- DOM要素 ---
        const getEl = (id) => document.getElementById(id);
        const DOMElements = {
            commentInput: getEl('comment-input'), sendCommentButton: getEl('send-comment-button'), commentHistory: getEl('comment-history'),
            openScriptModalButton: getEl('open-script-modal-button'), scriptCardContent: getEl('script-card-content'), nextScriptButton: getEl('next-script-button'),
            scriptModal: getEl('script-modal'), modalScriptList: getEl('modal-script-list'), scriptModalClose: getEl('script-modal-close'),
            matchupAlphaSelect: getEl('matchup-alpha-select'), matchupBravoSelect: getEl('matchup-bravo-select'),
            viewAlphaSelect: getEl('view-alpha-select'), viewBravoSelect: getEl('view-bravo-select'),
            syncViewButton: getEl('sync-view-button'), teamAlphaCard: getEl('team-alpha-card'), teamBravoCard: getEl('team-bravo-card'),
        };

        // --- レンダリング関数 ---
        const renderComments = () => {
            DOMElements.commentHistory.innerHTML = commentHistory.map(c => `
                <div class="comment-item">
                    <span class="badge ${c.sender === 'self' ? 'is-self' : 'is-other'}">${c.sender === 'self' ? 'Me' : 'Others'}</span>
                    <span class="text">${c.text}</span>
                </div>
            `).join('');
        };

        const renderScript = () => {
            const cardContent = scriptData.slice(scriptState.currentIndex, scriptState.currentIndex + 2).map((p, i) =>
                `<p class="script-paragraph ${i === 0 && scriptState.currentIndex < scriptData.length ? 'is-current' : ''}"><b>${p.speaker}:</b> ${p.line}</p>`
            ).join('');
            DOMElements.scriptCardContent.innerHTML = cardContent || '<p class="script-paragraph is-done">台本は終了しました。</p>';

            DOMElements.modalScriptList.innerHTML = scriptData.map((p, i) => {
                let statusClass = '';
                if (i < scriptState.currentIndex) statusClass = 'is-done';
                if (i === scriptState.currentIndex) statusClass = 'is-current';
                return `<div class="script-paragraph ${statusClass}" data-index="${i}"><b>${p.speaker}:</b> ${p.line}</div>`;
            }).join('');
        };
        
        const createTeamCardHTML = (team) => {
            if (!team) return '<h3>チームを選択してください</h3>';
            const playerListHTML = team.players.map(p => `
                <li class="player-item">
                    <div class="player-main-info">
                        <span class="name">${p.name}</span>
                        <span class="xp-badge ${p.xp >= 3200 ? 'is-highlight' : ''}">XP: ${p.xp}</span>
                    </div>
                    <div class="player-weapons">${p.weapons.join(' / ')}</div>
                </li>`).join('');
            return `
                <p class="university-name">${team.university}</p><h2 class="team-name">${team.teamName}</h2>
                <p class="sub-info">${team.circleName}</p><h3>プレイヤー情報</h3><ul class="player-list">${playerListHTML}</ul>
                <h3>コメント</h3><p>${team.comment}</p><h3>チーム補足情報</h3><p>${team.teamInfo}</p>
                <h3>プレイヤー補足情報</h3><p>${team.playerInfo}</p><h3>サークル情報</h3><p>${team.circleInfo}</p>`;
        };
        const updateTeamDisplay = () => {
            const alphaTeam = teamsData.find(t => t.id === DOMElements.viewAlphaSelect.value);
            const bravoTeam = teamsData.find(t => t.id === DOMElements.viewBravoSelect.value);
            DOMElements.teamAlphaCard.innerHTML = createTeamCardHTML(alphaTeam);
            DOMElements.teamBravoCard.innerHTML = createTeamCardHTML(bravoTeam);
        };
        
        // --- イベントリスナー ---
        const advanceScript = () => {
            if (scriptState.currentIndex < scriptData.length) {
                scriptState.currentIndex++;
                renderScript();
            }
        };

        DOMElements.sendCommentButton.onclick = () => {
            const text = DOMElements.commentInput.value.trim();
            if (text) {
                commentHistory.push({ sender: 'self', text });
                if (commentHistory.length > 2) commentHistory.shift();
                renderComments();
                DOMElements.commentInput.value = '';
            }
        };
        DOMElements.nextScriptButton.onclick = advanceScript;
        DOMElements.openScriptModalButton.onclick = () => DOMElements.scriptModal.classList.add('is-active');
        DOMElements.scriptModalClose.onclick = () => DOMElements.scriptModal.classList.remove('is-active');
        DOMElements.scriptModal.onclick = (e) => { if (e.target === DOMElements.scriptModal) DOMElements.scriptModal.classList.remove('is-active'); };
        DOMElements.modalScriptList.onclick = (e) => {
            const target = e.target.closest('.script-paragraph');
            if (target && target.classList.contains('is-current')) {
                advanceScript();
            }
        };
        
        // --- 初期化 ---
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('select').forEach(select => {
                teamsData.forEach(team => {
                    const option = document.createElement('option');
                    option.value = team.id;
                    option.textContent = team.teamName;
                    select.appendChild(option);
                });
            });

            const initialAlpha = teamsData[0];
            const initialBravo = teamsData[1];
            DOMElements.matchupAlphaSelect.value = initialAlpha.id;
            DOMElements.matchupBravoSelect.value = initialBravo.id;
            DOMElements.viewAlphaSelect.value = initialAlpha.id;
            DOMElements.viewBravoSelect.value = initialBravo.id;
            
            DOMElements.viewAlphaSelect.onchange = updateTeamDisplay;
            DOMElements.viewBravoSelect.onchange = updateTeamDisplay;
            DOMElements.syncViewButton.onclick = () => {
                DOMElements.viewAlphaSelect.value = DOMElements.matchupAlphaSelect.value;
                DOMElements.viewBravoSelect.value = DOMElements.matchupBravoSelect.value;
                updateTeamDisplay();
            };

            renderComments();
            renderScript();
            updateTeamDisplay();
        });
    </script>
</body>
</html>